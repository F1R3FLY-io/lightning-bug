<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lightning Bug Demo</title>
  <link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="css/demo.css">
  <script type="importmap">
    {
      "imports": {
        "@f1r3fly-io/lightning-bug": "./node_modules/@f1r3fly-io/lightning-bug/dist/libs/lib.core.js",
        "@f1r3fly-io/lightning-bug/extensions": "./node_modules/@f1r3fly-io/lightning-bug/dist/libs/ext.lang.rholang.js",
        "react": "https://esm.sh/react@19.0.0-rc-f994737d14-20240522",
        "react-dom": "https://esm.sh/react-dom@19.0.0-rc-f994737d14-20240522",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0-rc-f994737d14-20240522/client",
        "rxjs": "https://esm.sh/rxjs@7.8.2",
        "@codemirror/autocomplete": "./node_modules/@codemirror/autocomplete/dist/index.js",
        "@codemirror/commands": "./node_modules/@codemirror/commands/dist/index.js",
        "@codemirror/language": "./node_modules/@codemirror/language/dist/index.js",
        "@codemirror/state": "./node_modules/@codemirror/state/dist/index.js",
        "@codemirror/view": "./node_modules/@codemirror/view/dist/index.js",
        "@marijn/find-cluster-break": "./node_modules/@marijn/find-cluster-break/src/index.js",
        "style-mod": "./node_modules/style-mod/src/style-mod.js",
        "w3c-keyname": "./node_modules/w3c-keyname/index.js",
        "crelt": "./node_modules/crelt/index.js",
        "@lezer/common": "./node_modules/@lezer/common/dist/index.js",
        "@lezer/highlight": "./node_modules/@lezer/highlight/dist/index.js",
        "web-tree-sitter": "./node_modules/web-tree-sitter/tree-sitter.js"
      }
    }
  </script>
  <script>
    var global = globalThis;  // Or window.global = window; for older browsers
  </script>
  <script type="module">
   (async () => {
      const React = await import('react');
      const { createRoot } = await import('react-dom/client');
      const { Editor } = await import('@f1r3fly-io/lightning-bug');
      const { RholangExtension } = await import('@f1r3fly-io/lightning-bug/extensions');
      const { keymap } = await import('@codemirror/view');
      const { defaultKeymap } = await import('@codemirror/commands');
      const customExtensions = [keymap.of(defaultKeymap)];
      const root = createRoot(document.getElementById('app'));
      const editorRef = React.createRef();
      root.render(React.createElement(Editor, {
        ref: editorRef,
        languages: {"rholang": RholangExtension},
        extraExtensions: customExtensions,
        preloadLanguages: ["rholang"]
      }));
      const interval = setInterval(() => {
        if (editorRef.current && editorRef.current.isReady()) {
          clearInterval(interval);
          const subscription = editorRef.current.getEvents().subscribe(event => {
            console.log('Event:', event.type, event.data);
          });
          editorRef.current.openDocument(
            "demo.rho",
            "new x in { x!(\"Hello\") | Nil }",
            "rholang"
          );
          console.log('State:', editorRef.current.getState());
          editorRef.current.setCursor({ line: 1, column: 3 });
          console.log('Cursor:', editorRef.current.getCursor());
          editorRef.current.setSelection({ line: 1, column: 1 }, { line: 1, column: 6 });
          console.log('Selection:', editorRef.current.getSelection());
          console.log('Text:', editorRef.current.getText());
          console.log('File Path:', editorRef.current.getFilePath());
          console.log('File URI:', editorRef.current.getFileUri());
          console.log('Diagnostics:', editorRef.current.getDiagnostics());
          console.log('Symbols:', editorRef.current.getSymbols());
        }
      }, 100);
    })();
  </script>
</head>
<body>
  <div id="app" style="height: 100vh;"></div>
</body>
</html>
